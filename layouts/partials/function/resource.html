{{- $resource := 0 -}}
{{- $url := urls.Parse .Path -}}
{{- if not $url.Host | and $url.Path | and (strings.HasSuffix $url.Path "/" | not) -}}
    {{- if .Resources -}}
        {{- with .Resources.GetMatch $url.Path -}}
            {{- $resource = . -}}
        {{- end -}}
    {{- end -}}
    {{- if not $resource -}}
        {{- with resources.Get $url.Path -}}
            {{- $resource = . -}}
        {{- end -}}
    {{- end -}}
{{- else -}}
    {{- with $remoteResource := resources.GetRemote .Path -}}
        {{- with .Err -}}
            {{- erroridf "resource-get-remote-error" "%#v" . -}}
        {{ else }}
            {{- if eq $remoteResource.ResourceType "image" -}}
                {{- $resource = $remoteResource -}}
            {{- end -}}
        {{- end -}}
    {{- end -}}
{{- end -}}
{{- return $resource -}}
